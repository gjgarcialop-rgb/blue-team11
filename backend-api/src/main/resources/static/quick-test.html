<!DOCTYPE html>
<html>
<head>
    <title>Quick Image Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #fff; }
        .property { background: #2d2d2d; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
        .warning { color: #dcdcaa; }
        img { max-width: 200px; margin: 10px; border: 2px solid #555; }
    </style>
</head>
<body>
    <h1>üîç Quick Image Test</h1>
    <button onclick="testImages()" style="padding: 10px 20px; font-size: 16px; cursor: pointer;">üîÑ Fetch & Test Images</button>
    <div id="output"></div>

    <script>
        async function testImages() {
            const output = document.getElementById('output');
            output.innerHTML = '<p>Loading...</p>';
            
            try {
                const response = await fetch('/api/properties');
                const properties = await response.json();
                
                output.innerHTML = '<h2>Found ' + properties.length + ' properties</h2>';
                
                properties.forEach((prop, idx) => {
                    const div = document.createElement('div');
                    div.className = 'property';
                    
                    let html = '<h3>' + (prop.title || 'Untitled') + ' (ID: ' + prop.id + ')</h3>';
                    
                    // Show raw images field
                    html += '<p><strong>Images Field (raw):</strong></p>';
                    html += '<pre style="background:#1e1e1e; padding:10px; overflow:auto; max-height:100px;">';
                    html += prop.images ? JSON.stringify(prop.images).substring(0, 500) + '...' : '<span class="error">NULL</span>';
                    html += '</pre>';
                    
                    // Try to parse
                    let images = [];
                    let parseError = null;
                    try {
                        if (prop.images) {
                            images = JSON.parse(prop.images);
                            if (!Array.isArray(images)) {
                                parseError = 'Parsed but not an array: ' + typeof images;
                                images = [];
                            } else {
                                html += '<p class="success">‚úÖ Successfully parsed as JSON array with ' + images.length + ' image(s)</p>';
                            }
                        } else {
                            html += '<p class="warning">‚ö†Ô∏è Images field is null/empty</p>';
                        }
                    } catch (e) {
                        parseError = e.message;
                        html += '<p class="error">‚ùå JSON parse failed: ' + e.message + '</p>';
                    }
                    
                    if (parseError) {
                        html += '<p class="error">Parse Error: ' + parseError + '</p>';
                    }
                    
                    // Try to display images
                    if (images.length > 0) {
                        html += '<p><strong>Attempting to display ' + images.length + ' image(s):</strong></p>';
                        images.forEach((img, i) => {
                            const isBase64 = img.startsWith('data:');
                            const isUrl = img.startsWith('http') || img.startsWith('/');
                            html += '<div style="display:inline-block; margin:10px;">';
                            html += '<p style="font-size:12px;">Image ' + (i+1) + ': ' + 
                                    (isBase64 ? 'üìÅ Base64 (' + img.length + ' chars)' : 
                                     isUrl ? 'üîó URL' : '‚ùì Unknown') + '</p>';
                            html += '<img src="' + img + '" onerror="this.style.border=\'3px solid red\'; this.alt=\'FAILED\';" onload="this.style.border=\'3px solid green\';">';
                            html += '</div>';
                        });
                    }
                    
                    div.innerHTML = html;
                    output.appendChild(div);
                });
                
            } catch (error) {
                output.innerHTML = '<p class="error">Error: ' + error.message + '</p>';
            }
        }
        
        // Auto-run on load
        testImages();
    </script>
</body>
</html>
